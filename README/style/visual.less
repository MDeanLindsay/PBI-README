// Import GitHub markdown CSS
@import (less) "~github-markdown-css/github-markdown.css";

// Host container should fill the visual area
:host {
    display: block;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.markdown-body {
    overflow: auto;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    padding: 8px;
    background: transparent;
    color: var(--pbi-color-foreground, inherit);
    
    // Override GitHub markdown CSS font family with user selection
    font-family: var(--custom-font-family, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif) !important;
    
    // Enable smooth scrolling for the container
    scroll-behavior: smooth;
    
    // Scale everything proportionally based on base font size
    font-size: var(--base-font-size, 16px);

    // Focus styles for the container itself
    &:focus {
        outline: 2px solid var(--pbi-color-foreground, #0366d6);
        outline-offset: -2px;
    }

    // High contrast support for code elements
    code, pre {
        background-color: var(--pbi-color-background-lighter, #f6f8fa);
        color: var(--pbi-color-foreground, inherit);
        border: 1px solid var(--pbi-color-foreground-neutral-tertiary, #d0d7de);
        
        &:focus {
            outline: 2px solid var(--pbi-color-foreground, #0366d6);
            outline-offset: 2px;
        }
    }

    // Ensure sufficient contrast for table borders
    table, th, td {
        border-color: var(--pbi-color-foreground-neutral-tertiary, #d0d7de);
    }

    // High contrast support for blockquotes
    blockquote {
        border-left-color: var(--pbi-color-foreground-neutral-secondary, #57606a);
        color: var(--pbi-color-foreground-neutral-secondary, #57606a);
    }
    
    h1 { 
        font-size: calc(var(--base-font-size, 16px) * 2) !important; 
        font-family: inherit !important;
    }
    h2 { 
        font-size: calc(var(--base-font-size, 16px) * 1.5) !important; 
        font-family: inherit !important;
    }
    h3 { 
        font-size: calc(var(--base-font-size, 16px) * 1.25) !important; 
        font-family: inherit !important;
    }
    h4 { 
        font-size: calc(var(--base-font-size, 16px) * 1) !important; 
        font-family: inherit !important;
    }
    h5 { 
        font-size: calc(var(--base-font-size, 16px) * 0.875) !important; 
        font-family: inherit !important;
    }
    h6 { 
        font-size: calc(var(--base-font-size, 16px) * 0.85) !important; 
        font-family: inherit !important;
    }
    
    p, li, td, th, span, div, blockquote, code, pre {
        font-size: var(--base-font-size, 16px) !important;
        font-family: inherit !important;
    }
    
    // Mixin for consistent list styling
    .list-base() {
        list-style: initial !important;
        margin: 16px 0 !important;
        padding-left: 2em !important;
    }
    
    .list-item-base() {
        display: list-item !important;
        margin: 0.25em 0 !important;
    }
    
    // Apply to all lists
    ul, ol {
        .list-base();
    }
    
    li {
        .list-item-base();
    }
    
    // Fix spacing for nested lists to prevent extra line breaks
    ul ul, ol ol, ul ol, ol ul {
        margin: 0.25em 0 !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
    }
    
    // Ensure nested list items don't have extra spacing
    ul ul li, ol ol li, ul ol li, ol ul li {
        margin: 0.125em 0 !important;
    }
    
    // List type specific styles
    ul li { list-style-type: disc !important; }
    ol li { list-style-type: decimal !important; }
    ul ul li { list-style-type: circle !important; }
    ul ul ul li { list-style-type: square !important; }
    ol ol li { list-style-type: lower-alpha !important; }
    
    // Enhance internal links styling with high-contrast support
    a[href^="#"] {
        color: var(--pbi-color-foreground, #0366d6);
        text-decoration: none;
        cursor: pointer;
        border-bottom: 1px dotted var(--pbi-color-foreground, #0366d6);
        font-family: inherit !important;
        
        &:hover {
            text-decoration: underline;
            border-bottom: 1px solid var(--pbi-color-foreground, #0366d6);
            background-color: var(--pbi-color-background-hover, transparent);
        }
        
        &:visited {
            color: var(--pbi-color-foreground-neutral-secondary, #6f42c1);
        }

        &:focus {
            outline: 2px solid var(--pbi-color-foreground, #0366d6);
            outline-offset: 2px;
        }
    }

    // Ensure all links inherit the font family
    a {
        font-family: inherit !important;
    }
    
    // Add padding to headers to provide better scroll target positioning
    h1, h2, h3, h4, h5, h6 {
        scroll-margin-top: 20px;
        position: relative;
        color: var(--pbi-color-foreground, inherit);
        
        // Focus styles for keyboard navigation
        &:focus {
            outline: 2px solid var(--pbi-color-foreground, #0366d6);
            outline-offset: 2px;
            background-color: var(--pbi-color-background-hover, rgba(0, 0, 0, 0.1));
        }
        
        // Add a subtle anchor point indicator on hover
        &:hover::before {
            content: "ðŸ”—";
            position: absolute;
            left: -20px;
            opacity: 0.5;
            font-size: 0.8em;
        }
        
        // CSS :target pseudo-class for navigation feedback
        &:target {
            padding: 8px 12px;
            border-radius: 4px;
            margin: 8px 0;
            animation: highlight-fade 3s ease-out forwards;
        }
    }
    
    // Animation for the target highlight
    @keyframes highlight-fade {
        0% {
            background-color: var(--pbi-color-background-selected, #fff3cd);
            border-left: 4px solid var(--pbi-color-foreground, #ffc107);
        }
        100% {
            background-color: transparent;
            border-left: 4px solid transparent;
        }
    }
    
    // Ensure smooth scrolling behavior
    html {
        scroll-behavior: smooth;
    }

    // Selection state styling
    &.selected {
        border-left: 4px solid var(--pbi-color-foreground, #0078d4);
        background-color: var(--pbi-color-background-selected, rgba(0, 120, 212, 0.1));
        transition: all 0.2s ease-in-out;
    }

    // Hover effect for selection (only when not in text selection mode)
    &:not(.text-selection-mode):hover {
        cursor: pointer;
        background-color: var(--pbi-color-background-hover, rgba(0, 0, 0, 0.05));
    }

    // Text selection mode styling
    &.text-selection-mode {
        cursor: text;
        user-select: text;
        -webkit-user-select: text;
        -moz-user-select: text;
        
        // Remove hover effects when in text selection mode
        &:hover {
            background-color: transparent;
        }
    }

    // Details/Summary dropdown styling
    details {
        margin: 16px 0;
        border: 1px solid var(--pbi-color-foreground-neutral-tertiary, #d0d7de);
        border-radius: 6px;
        background-color: var(--pbi-color-background-lighter, #f6f8fa);
        font-family: inherit !important;
        
        summary {
            padding: 12px 16px;
            cursor: pointer;
            font-weight: 600;
            color: var(--pbi-color-foreground, inherit);
            background-color: var(--pbi-color-background, #ffffff);
            border-radius: 6px 6px 0 0;
            font-family: inherit !important;
            font-size: var(--base-font-size, 16px) !important;
            list-style: none;
            position: relative;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            
            // Custom arrow indicator
            &::before {
                content: "â–¶";
                position: absolute;
                right: 16px;
                top: 50%;
                transform: translateY(-50%);
                transition: transform 0.2s ease;
                font-size: 0.8em;
                color: var(--pbi-color-foreground-neutral-secondary, #57606a);
            }
            
            // Remove default marker
            &::-webkit-details-marker {
                display: none;
            }
            
            &::-moz-list-bullet {
                list-style-type: none;
            }
            
            &:hover {
                background-color: var(--pbi-color-background-hover, rgba(0, 0, 0, 0.05));
            }
            
            &:focus {
                outline: 2px solid var(--pbi-color-foreground, #0366d6);
                outline-offset: -2px;
            }
        }
        
        // When details is open, rotate the arrow
        &[open] summary::before {
            transform: translateY(-50%) rotate(90deg);
        }
        
        // Content wrapper inside details - single fluid container
        .details-content {
            padding: 16px;
            margin: 0;
            border-top: 1px solid var(--pbi-color-foreground-neutral-tertiary, #d0d7de);
            background-color: var(--pbi-color-background, #ffffff);
            border-radius: 0 0 6px 6px;
            
            // Nested content styling
            p, h1, h2, h3, h4, h5, h6, ul, ol, li, blockquote, code, pre, table {
                margin: 0 0 16px 0;
                font-family: inherit !important;
                
                &:last-child {
                    margin-bottom: 0;
                }
            }
        }
        
        // Fallback for details with single content element (no wrapper)
        > *:not(summary):not(.details-content) {
            padding: 16px;
            margin: 0;
            border-top: 1px solid var(--pbi-color-foreground-neutral-tertiary, #d0d7de);
            background-color: var(--pbi-color-background, #ffffff);
            border-radius: 0 0 6px 6px;
            
            p, h1, h2, h3, h4, h5, h6, ul, ol, li, blockquote, code, pre, table {
                margin: 0 0 16px 0;
                font-family: inherit !important;
                
                &:last-child {
                    margin-bottom: 0;
                }
            }
        }
        
        // Focus styles for keyboard navigation
        &:focus-within {
            outline: 2px solid var(--pbi-color-foreground, #0366d6);
            outline-offset: 2px;
        }
    }
} 